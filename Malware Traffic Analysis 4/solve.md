# CyberDefenders - Malware Traffic Analysis 4
<br />

## Scenario:
<br />

### THE PLAYERS
#### Tom and Jake are recent hires at your organization's Security Operations Center (SOC analyst).  Due to their different personalities, they've earned the nickname "Goofus and Gallant" after a cartoon from the magazine Highlights for Children.  Tom is Goofus.  Jake is Gallant.
![1](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/6406d426-9cdb-4820-b2a5-876b0a01131c)
<br />

### THE STORY
#### On the Tuesday before Thanksgiving, Tom and Jake are working at the SOC as a SOC analysts.  Tom brought his Windows laptop to the office, and he plans to browse the web.  Jake is hard at work reviewing alerts.
![2](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/1d00cac3-2980-4bee-863f-8906ddabe536)
<br />

#### Jake's holiday plans are set, and he's happy with the frozen turkey he'd purchased from the supermarket.  Tom's more of a "turkey enthusiast."  He wants to hunt and kill a turkey for his Thanksgiving meal. To pursue his holiday plans, Tom decides to purchase a shotgun.  He fires up his Windows laptop, connects to the SOC's wifi, and starts researching shotguns online. It's not long before Tom's computer triggers some alerts for suspicious network activity.  After those alerts, his laptop crashes!
![3](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/5ac66cb5-57e2-4b76-95a0-737d1d05cf8d)
<br />

### THE AFTERMATH
#### You're the supervisor for both Goofus and Gallant. The Goofus Tom will likely be fired at some point due to his poor work ethic.  Jake is certainly gallant, but he's still a relatively inexperienced analyst. You'll have to figure out what happened to Tom's laptop.
![4](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/be777b74-edb1-4c70-886b-d465c8150ccc)
<br />

#### You check Tom's machine and quickly find a suspicious registry entry.  It looks like Goofus infected his laptop.  The SHA256 hash for the file referenced in the registry is: d16ad130daed5d4f3a7368ce73b87a8f84404873cbfc90cc77e967a83c947cd2
![5](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/9c2a5a44-0d92-43bd-baca-b1c40592457a)
<br />

#### Next, you review the network alerts.  Unfortunately, your organization is too cheap for any commercial intrusion detection system (IDS).  Fortunately, lower-cost solutions have been implemented.  You have access to Snort alerts using the Snort registered ruleset.  You also have access to Suricata alerts using the EmergingThreats free ruleset.
![6](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/a944685e-eacb-42c4-906c-8feb2c15703e)
<br />

## QUESTIONS:

### Q1/.What is the victim IP address?
#### A lot of traffic comming from this address.
![1](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/e53d4362-1df4-4829-94a9-3295ec5da38c)
#### > 10.1.25.119
<br />

### Q2/. What is the victim's hostname?
![2](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/b10749a0-13f9-4594-8715-9c1f9ab1e6ea)
#### > TURKEY-TOM
<br />

### Q3/. What is the exploit kit name?
#### Analyze pcap on PacketTotal and see this in the malicious activities.
![10](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/604ccbf4-36b9-447b-b68d-1761d4d7eccb)
#### A quick google search reveals the exploit kit.
![Screenshot 2023-05-22 at 21 18 47](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/8433a0f5-1db0-4840-94de-9df935f93a61)
#### > Angler
<br />

### Q4/. What is the IP address that served the exploit?
#### Trimmed search in Export Objects to quick inspect Content Type. I focused on application/flash files as it's the most ocurrent type to be suspected as malicious.
![4 1](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/3bc694f7-0988-4013-b81a-e7f3cfa141ba)
![4 2](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/0f05aa39-b757-4e1a-88ab-6d986eca089a)
#### Exported two files containing ActionScript and analyzed them on VirusTotal. One happen to be malicious !
![4 3](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/5e06b440-5b1e-4cf6-ae14-74c9a8dd0295)
![4 4](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/d9322296-17df-495b-8c1a-60c62d260893)
#### We have the FDQN which delivered the malware, filtering with tshark to get his IP.
![4 5](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/880c5ef9-8921-47c2-baf7-410adc4476ff)
#### > 165.216.4.20
<br />

### Q5/. What is the HTTP header that is used to indicate the flash version?
#### $ tshark -r *.pcap -Y "http.request || http.response" -O http| grep -i "neuhaus-hourankus" -A20 -B20
![5](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/035438d8-1a44-47ea-af03-6ab65f789bb6)
#### > x-flash-version
<br />

### Q6/. What is the malicious URL that redirects to the server serving the exploit? 
#### open in ZUI the pcap file and filter with the FDQN which delivered the exploit.
![7](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/3ac36f17-82ac-43f7-943e-6b552cb2e3e3)
#### > http://solution.babyboomershopping.org/respondents/header.js
<br />

### Q7/. What is The CAPEC ID corresponding to the technique used to redirect the victim to the exploit server? More info at capec.mitre.org
#### I recovered the IP of the infected website with tshark. I filtered then this IP on wireshark and inspected traffic tcp streams.
![7 1](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/c0ddf3a2-8ff1-428d-8cd6-49e2fc143a64)
![7 2](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/b049e624-f62f-4433-af1c-9b0a8fec592a)
![7 3](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/f7747ba8-90dc-4de2-a824-caea7f1d1fea)
#### A search on capec.mitre.org, gives us the ID.
![7 4](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/9b1ae85c-967c-4282-acfe-6e8fbb6ca1ad)
#### > CAPEC-222
<br />

### Q8/. What is the FQDN of the compromised website?
![8](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/cd22f12e-ecda-4dab-8073-9f0960edfc0e)
#### > shotgunworld.com
<br />

### Q9/. The compromised website contains a malicious js that redirect the user to another website. What is the variable name passed to the "document.write" function?
#### Filter FDQN above on tshark to get the comprised website's IP. Filter again on wireshark the IP found and look at tcp stream.
![9 1](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/8037a138-0a5a-44cc-9b77-2178ca6bff03)
![9 2](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/4b0ef358-3307-4e92-986b-c93f89761d04)
#### > OX_7f561e63
<br />

### Q10/. What is the Compilation Timestamp of the malware found on the machine? Format: YYYY-MM-DD hh:mm:ss
#### I am unable get the Angler EKâ€™s malware payload from the pcap at the moment, because the EK uses some sort of encryption. Usually when we see Angler EK traffic, we can find one of two things as the payload -> ransomware or Bedep.
![10](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/604ccbf4-36b9-447b-b68d-1761d4d7eccb)
#### ...
![maxresdefault](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/ba624d89-f027-43e6-a432-75eb413302d3)
#### Put given hash from "Details" on VirusTotal and inspect it.
![10 1](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/42892c8d-6f71-4345-8a61-32d5ee82b8c5)
![10 2](https://github.com/itsoktocryy/CyberDefenders/assets/73375576/8285173f-8c95-4c78-af94-a6c2d412a856)
#### > 2007-08-01 18:16:48
<br />
